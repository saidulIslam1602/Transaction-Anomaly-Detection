# Transaction Anomaly Detection System Configuration

# System settings
system:
  name: "Transaction Anomaly Detection System"
  version: "2.0.0"
  environment: "production"  # development, staging, production
  log_level: "INFO"
  output_dir: "./output"

# Data processing
data:
  sample_size: null  # null for all data
  validation_split: 0.2
  test_split: 0.2
  random_state: 42
  
  # Feature engineering
  features:
    numerical:
      - amount
      - oldbalanceOrg
      - newbalanceOrig
      - oldbalanceDest
      - newbalanceDest
    categorical:
      - type
    target: isFraud

# Rule-based detection
rule_engine:
  large_transaction_threshold: 10000.0
  structuring_threshold: 9000.0
  structuring_window: 24
  rapid_movement_threshold: 5
  rapid_movement_window: 10

# Adaptive thresholds
adaptive_thresholds:
  enabled: true
  n_segments: 5
  outlier_method: "iqr"  # iqr, zscore, mad

# Machine learning models
ml_models:
  isolation_forest:
    enabled: true
    contamination: 0.01
    n_estimators: 100
    
  xgboost:
    enabled: true
    max_depth: 6
    learning_rate: 0.1
    n_estimators: 100
    
  lightgbm:
    enabled: true
    num_leaves: 31
    learning_rate: 0.05
    n_estimators: 100
    
  random_forest:
    enabled: true
    n_estimators: 100
    max_depth: 10
    
  autoencoder:
    enabled: true
    encoding_dim: 14
    epochs: 50
    batch_size: 256

# Sequence models
sequence_models:
  enabled: true
  lstm_autoencoder:
    enabled: true
    sequence_length: 10
    hidden_dim: 64
    num_layers: 2
    
  transformer:
    enabled: false
    sequence_length: 10
    d_model: 128
    nhead: 8
    num_layers: 3

# Network analysis
network_analysis:
  enabled: true
  max_cycle_length: 10
  fan_out_threshold: 10
  fan_in_threshold: 10
  
  # GNN settings
  gnn:
    enabled: false  # Requires PyTorch Geometric
    hidden_dim: 64
    num_layers: 3
    learning_rate: 0.001

# LLM service
llm:
  enabled: false  # Requires OpenAI API key
  provider: "openai"
  model: "gpt-4"
  temperature: 0.3
  max_tokens: 500
  
  # Multi-language support
  supported_languages:
    - en
    - no  # Norwegian
    - sv  # Swedish
    - dk  # Danish
  
  # Rate limiting
  rate_limit:
    requests_per_minute: 60
    requests_per_day: 10000

# RAG pipeline
rag:
  enabled: false  # Requires ChromaDB and sentence-transformers
  embedding_model: "all-MiniLM-L6-v2"
  vector_db_path: "./chroma_db"
  similarity_threshold: 0.7
  n_context: 20

# Feature store
feature_store:
  enabled: true
  storage_path: "./feature_store"
  online_cache_size: 1000
  aggregation_windows:
    - 1  # 1 hour
    - 24  # 24 hours
    - 168  # 1 week

# Merchant services
merchant_services:
  enabled: true
  risk_profile_update_frequency: "daily"
  alert_prioritization:
    enabled: true
    critical_threshold: 80
    high_threshold: 60
    medium_threshold: 40
  
  onboarding_assessment:
    enabled: true
    high_risk_industries:
      # High-risk industries based on FinCEN and international AML standards
      - gambling
      - casino
      - betting
      - cryptocurrency
      - crypto
      - bitcoin
      - adult entertainment
      - forex
      - money transfer
      - remittance
      - precious metals
      - jewelry
      - arms
      - weapons
      - tobacco
      - cannabis
      - pawn shop
      - cash intensive business
      - money service business
    
    medium_risk_industries:
      # Industries requiring enhanced due diligence
      - real estate
      - car dealer
      - art dealer
      - nonprofit
      - charity
      - travel agency
      - import export
      - consulting
    
    high_risk_countries:
      # FATF high-risk jurisdictions (update regularly per official publications)
      - iran
      - north korea
      - myanmar
      - afghanistan
      - syria
      - yemen
    
    enhanced_monitoring_countries:
      # Jurisdictions requiring enhanced due diligence
      - cayman islands
      - panama
      - uae
      - philippines

# Model monitoring
monitoring:
  enabled: true
  drift_detection:
    enabled: true
    significance_level: 0.05
    check_frequency: "daily"
  
  performance_monitoring:
    enabled: true
    alert_thresholds:
      accuracy: 0.90
      precision: 0.85
      recall: 0.80
      f1_score: 0.85
      auc: 0.90
  
  prediction_monitoring:
    enabled: true
    window_size: 1000

# Compliance and explainability
compliance:
  enabled: true
  audit_logging:
    enabled: true
    log_file: "./logs/decision_audit.jsonl"
  
  explainability:
    enabled: true
    shap_enabled: true
    top_features_count: 10
  
  reporting:
    enabled: true
    aml_threshold: 10000.0
    report_frequency: "monthly"

# Risk scoring
risk_scoring:
  weights:
    rule_based: 1.0
    ml_based: 3.0
    network_based: 2.0
  high_risk_threshold: 2.0
  adaptive_threshold_multiplier: 1.5  # For adaptive threshold calculation
  normalization_range: [0, 10]

# MLflow tracking
mlflow:
  enabled: true
  tracking_uri: "./mlruns"
  experiment_name: "transaction_anomaly_detection"

# Real-time processing
real_time:
  enabled: false  # Requires Kafka/Redis setup
  feature_latency_target_ms: 100
  prediction_latency_target_ms: 200
  
  kafka:
    # Can be overridden with REAL_TIME_KAFKA_BOOTSTRAP_SERVERS env var
    bootstrap_servers: "localhost:9092"
    input_topic: "transactions"
    output_topic: "anomaly_scores"
  
  redis:
    # Can be overridden with REAL_TIME_REDIS_HOST, REAL_TIME_REDIS_PORT env vars
    host: "localhost"
    port: 6379
    db: 0

# API deployment
api:
  enabled: false
  host: "0.0.0.0"
  port: 8000
  workers: 4
  reload: false

# Alert notification
notifications:
  enabled: false
  email:
    enabled: false
    # Can be overridden with NOTIFICATIONS_EMAIL_SMTP_SERVER env var
    smtp_server: "smtp.example.com"
    smtp_port: 587
    # Can be overridden with NOTIFICATIONS_EMAIL_FROM_ADDRESS env var
    from_address: "alerts@example.com"
  
  webhook:
    enabled: false
    # Can be overridden with NOTIFICATIONS_WEBHOOK_URL env var
    url: "https://example.com/webhook"

# Performance tuning
performance:
  n_jobs: -1  # Use all CPU cores
  batch_size: 1000
  chunk_size: 10000

# Business metrics
business_metrics:
  cost_per_alert_review: 10.0
  industry_benchmarks:
    avg_fraud_rate: 0.02
    avg_risk_score: 3.5
    avg_transaction_amount: 5000.0

# Data preprocessing
preprocessing:
  outlier_detection:
    iqr_multiplier: 3.0
    epsilon: 0.01
  feature_engineering:
    velocity_window_hours: 24

# Merchant services configuration
merchant_services:
  risk_thresholds:
    high_risk: 7.0
    medium_risk: 4.0
    low_risk: 2.0
  
  health_score:
    base_score: 100.0
    fraud_rate_multiplier: 500
    risk_score_threshold: 5.0
    risk_score_penalty: 10.0
  
  recommendations:
    fraud_rate_threshold: 0.05
    risk_score_threshold: 6.0
    min_transactions_threshold: 10
  
  alert_prioritization:
    amount_thresholds:
      critical: 10000
      high: 5000
      medium: 1000
    detection_method_scores:
      rule_based: 15
      ml: 10
      network: 12
      immediate_action: 25
    priority_levels:
      critical: 80
      high: 60
      medium: 40
    fraud_rate_multiplier: 50
  
  onboarding:
    risk_score_thresholds:
      reject: 60
      monitor: 40
      review: 20
    business_age_thresholds:
      new_business_years: 1
      young_business_years: 3
    business_age_scores:
      new_business: 15
      young_business: 10
    high_risk_industry_score: 30
    medium_risk_industry_score: 15
    ownership_not_verified_score: 20
    not_registered_score: 30
    high_limit_threshold: 1000000
    high_limit_score: 15
    high_risk_country_score: 25
    enhanced_monitoring_country_score: 15
    transaction_limits:
      high_risk: 10000
      medium_risk: 50000
      low_risk: 100000
      very_low_risk: 500000

# Training and sampling
training:
  sample_sizes:
    normal_transactions: 10000
    fraud_transactions: 10000
    total_sample_limit: 20000
  high_risk_accounts_limit: 100

# API configuration
api:
  enabled: false
  host: "0.0.0.0"
  port: 8000
  workers: 4
  reload: false
  
  prediction:
    fraud_threshold: 0.7
    default_confidence: 0.85
    risk_level_thresholds:
      critical: 0.75
      high: 0.5
      medium: 0.25
    
    risk_calculation:
      amount_weight: 0.4
      balance_ratio_weight: 0.3
      transaction_type_weight: 0.3
      amount_normalizer: 10000.0
      high_risk_types: ['TRANSFER', 'CASH_OUT']
      high_risk_type_score: 1.0
      low_risk_type_score: 0.3

# Model monitoring thresholds
model_monitoring:
  drift_detection:
    significance_level: 0.05
  performance_thresholds:
    trend_improving: 0.01
    trend_degrading: -0.01
  prediction_monitoring:
    anomaly_threshold_std: 2.0
    min_samples_for_detection: 100

# Debugging
debug:
  enabled: false
  save_intermediate_results: false
  verbose_logging: false
